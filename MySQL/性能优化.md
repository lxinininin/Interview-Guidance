## SQL 优化手段有哪些

*   **尽量避免使用 SELECT ***：只选择所需的列，可以减少传输的数据量和处理时间。
*   **使用 WHERE 子句过滤数据**：尽量在查询中使用WHERE子句过滤数据，减少返回的行数。
*   **尽量避免使用子查询**：可以将子查询改为JOIN操作，减少嵌套查询的复杂度和执行时间。
*   **使用 JOIN 替代子查询**：在很多情况下，JOIN比子查询更高效。(LEFT JOIN, RIGHT JOIN, INNER JOIN)
*   **减少使用 IN 或者 NOT IN**: 使用 EXISTS, NOT EXISTS 或者关联查询语句替代
*   **OR 的查询尽量用 UNION 或者 UNION ALL 代替**: 在确认没有重复数据或者不用剔除重复数据时, UNION ALL 会更好
*   **尽量避免在 WHERE 子句中使用 != 或 <> 操作符**: 否则将导致引擎放弃使用索引而进行全表扫描
*   **尽量避免在 WHERE 子句中对字段进行 NULL 值判断**: 否则将导致引擎放弃使用索引而进行全表扫描, 如 SELECT id FROM t WHERE num IS NULL 可以在 num 上设置默认值为 0, 确保表中的 num 列没有 NULL 值, 然后这样查询: SELECT id FROM t WHERE num=0



## 大表如何优化

当 MySQL 单表记录数过大时, 数据库的 CRUD 性能会明显下降, 一些常见的优化措施如下:

1.   **限定数据的范围**: 务必禁止不带任何限制数据范围条件的查询语句; 比如: 我们当用户在查询订单历史的时候, 我们可以控制在一个月的范围内

2.   **读/写分离**: 经典的数据库拆分方案, 主库负责写, 从库负责读

3.   **垂直分区**: 将大表拆分成多个小表，每个小表包含部分列。通过垂直分割可以将热点数据和冷数据分离，提高数据访问效率。例如，将大表中的常用列和不常用列分别存储在不同的表中。

     *   **优点**: 可以使得列数据变小, 在查询时减少读取的 Block 数, 减少 I/O 次数; 此外, 垂直分区可以简化表的结构, 易于维护
     *   **缺点**: 主键会出现冗余, 需要管理冗余列, 并会引起 JOIN 操作; 此外, 垂直分区会让事务变得更加复杂

     <img src="assets/image-20240516160435405.png" alt="image-20240516160435405" style="zoom: 33%;" />

4.   **水平分区**: 将大表按照某个条件（如ID范围、日期范围等）拆分成多个子表，每个子表包含部分数据。水平分割可以减少单个表的数据量，提高查询性能和并发能力。例如, 我们可以将用户信息表拆分成多个用户信息表, 这样就可以避免单一表数据量过大对性能造成影响

     *   **优点**: 不存在单库大数据和高并发的性能瓶颈; 应用端改造较少; 提高了系统的稳定性和负载能力
     *   **缺点**: 分片事务一致性难以解决; 跨节点 JOIN 性能差, 逻辑复杂; 数据多次拓展难度和维护量极大
     *   需要注意的一点是: 分表仅仅是解决了单一表数据过大的问题, 但由于表的数据还是在同一台机器上, 其实对于提升 MySQL 并发能力没有什么意义, 所以**水平拆分最好分库**

     <img src="assets/image-20240516162005478.png" alt="image-20240516162005478" style="zoom:50%;" />